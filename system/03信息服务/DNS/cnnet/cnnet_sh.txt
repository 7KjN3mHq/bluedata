#!/bin/sh
FILE=/tmp/ip_apnic
rm -f $FILE 
wget http://ftp.apnic.net/apnic/stats/apnic/delegated-apnic-latest -O $FILE
grep 'apnic|CN|ipv4|' $FILE | cut -f 4,5 -d'|'| sed -e 's/|/ /g' | while read ip cnt
do
  echo $ip:$cnt
mask=$(cat << EOF | bc | tail -1
pow=32;
define log2(x)
{
  if(x<=1) return(pow);
  pow--;
  return(log2(x/2));
}
log2($cnt)
EOF)
  echo $ip/$mask >> cnnet.txt
  NETNAMEF=`whois $ip@whois.apnic.net | sed -e '/./{H;$!d;}' -e 'x;/netnum/!d' | grep ^netname | sed -e 's/.*:      \(.*\)/\1/g' | sort -u`
  NETNAMEL=`echo $NETNAMEF | sed -e 's/-.*//g'`
  case $NETNAMEL in
  CHINANET|CHINATELECOM)
    echo $ip/$mask >> chinanet.txt
  ;;
  CNCGROUP)
    echo $ip/$mask >> cncgroup.txt
  ;;
  esac
  case $NETNAMEF in
  YINGYFWQ-INFORMATION-CENTER|SN-COM-NET-INFO-CENT-NET|SNXIAN|HFLAN|WHTEL|BBTEL|SXXZX|JX-DCB|CNINFONET-XJ|WH-CHINANET-NIC|CSIF|DNS-VLAN|XN-TELCOM|JINHUA-TELECOM-COMPANY|SHANGHAI-ONLINE)
    echo $ip/$mask >> chinanet.txt
  ;;
  DQTNET|CNC-JS-suzhou-MAN|CHINAINFO-SD|SH-CHINA-NETCOM|guotong-stock|CQCNC)
    echo $ip/$mask >> cncgroup.txt
  ;;
  HFLAN|WHTEL|BBTEL|CHINANET-FJ|CHINANET-JS|CHINANET-JS-XZ|CHINANET-JX|JX-DCB|CHINANET-SH|SHANGHAI-ONLINE|CHINANET-ZJ-ZX|CHINANET-ZJ-HZ|JINHUA-TELECOM-COMPANY|CHINANET-ZJ-WZ)
    echo $ip/$mask >> chinanet-east.txt
  ;;
  CHINANET-GD|CHINANET-GX|CHINANET-HI|CHINANET-HB|WH-CHINANET-NIC|CHINANET-HN|CHINANET-HN-SY|SXXZX|CHINANET-HN-HH|CSIF)
    echo $ip/$mask >> chinanet-south.txt
  ;;
  YINGYFWQ-INFORMATION-CENTER|NETWORK-ADMIN-LAN|CHINANET-GZ|DNS-VLAN|XN-TELCOM|CHINANET-SN|SNXIAN|CHINANET-BB-IDC|SN-COM-NET-INFO-CENT-NET|CHINANET-SC|CHINANET-XZ|CNINFONET-XJ|CHINANET-YN|CHINANET-CQ)
    echo $ip/$mask >> chinanet-west.txt
  ;;
  CHINANET-BB|CHINANET-SD)
    echo $ip/$mask >> chinanet-north.txt
  ;;
  CNCGROUP-JS|CNC-JS-suzhou-MAN|CNCGROUP-CN|SH-CHINA-NETCOM|guotong-stock)
    echo $ip/$mask >> cncgroup-east.txt
  ;;
  CNCGROUP-SC|CQCNC)
    echo $ip/$mask >> cncgroup-west.txt
  ;;
  CNCGROUP-BJ|CNCGROUP-SD|CHINAINFO-SD|CNCGROUP-HA|CNCGROUP-HE|CNCGROUP-HL|DQTNET|CNCGROUP-JL|CNCGROUP-LN|CNCGROUP-NM|CNCGROUP-SX|CNCGROUP-TJ)
    echo $ip/$mask >> cncgroup-north.txt
  ;;
  CRTC|CRGxBsS|CRHunCsS)
    echo $ip/$mask >> crtc.txt
  ;;
  GWBN)
    echo $ip/$mask >> gwbn.txt
  ;;
  CMNET)
    echo $ip/$mask >> cmnet.txt
  ;;
  UNICOM)
    echo $ip/$mask >> unicom.txt
  ;;
  esac
done