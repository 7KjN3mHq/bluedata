项目主页：
http://awstats.sourceforge.net/

安装 AWStats
wget http://prdownloads.sourceforge.net/awstats/awstats-6.8.tar.gz
tar zxvf awstats-6.8.tar.gz
mv awstats-6.8/wwwroot/cgi-bin /var/www/html/awstats

配置
cd /var/www/html/awstats
mv awstats.model.conf common.conf
vi common.conf
# 解决中文搜索引擎统计问题
LoadPlugin="decodeutfkeys"

创建 data 目录用于统计数据输出：
mkdir data

创建配置文件：
vi awstats.jc001.cn.conf
Include "common.conf"
LogFile="/home/awstats/log/access_log"
SiteDomain="jc001.cn"
HostAliases="jc001.cn www.jc001.cn"
DefaultFile="index.html"
DirData="/var/www/html/awstats/data/"

安装插件
安装纯真版 IP 数据库来分析 IP
下载 纯真版 IP 数据库：
http://www.cz88.net/fox/
解压后得到 QQWry.Dat 。

下载 qqhostinfo.pm 和 qqwry.pl 用于分析 QQWry.dat:
wget http://www.ieasy.org/download/qqhostinfo.pm
wget http://www.ieasy.org/download/qqwry.pl
编辑 qqwry.pl ，把 ./QQWry.Dat 改为 ${DIR}/plugins/QQWry.Dat 。
把 QQWry.Dat, qqhostinfo.pm, qqwry.pl 放在 awstats/plugins 下。

使用 qqhostinfo 插件需要安装 Net::XWhois 模块：
yum -y install perl-Net-XWhois

vi awstats.jc001.cn.conf
LoadPlugin="qqhostinfo"


/home/awstats/awstats.pl -update -databasebreak=day -config=jc001.cn


多台服务日志合并问题：把多个日志中的记录按时间排序后合并成一个文件
sort -m -t " " -k 4 -o access.log ld1 ld2 web1 web2 web3 web4
sort -m -t " " -k 4 -o access_log.`date +%Y%m%d --date='1 days ago'` ld1 ld2
注释：
-m: 使用 merge优化算法

按天进行统计：
命令行统计增加： -databasebreak=day
报表输出时增加： &databasebreak=day&day=DD
即可解决按月统计归档数据过大导致统计过慢或失败的问题。

AWStats的补充定义：区分百度图片搜索和一些新出现的流量较大蜘蛛
http://www.chedong.com/lib.tgz
蜘蛛定义部分增加了区分Yahoo!中国，Soso 豆瓣，鲜果等，其他的是几个国外的RSS阅读器；
搜索引擎部分区分了百度图片，有道搜索，soso搜索

给AWStats增加去百度，谷歌和雅虎的查询链接
diff -b -r1.896 awstats.pl
6356d6355
<                       || $field[$pos_method] eq 'HEAD'
8824c8823,8889
<                       print "<tr><td class=\"aws\">".XMLEncode($mot)."</td><td>$_keyphrases{$key}</td><td>$p %</td></tr>\n";
---
>                       # print "<tr><td class=\"aws\">".XMLEncode($mot)."</td><td>$_keyphrases{$key}</td><td>$p %</td></tr>\n";
>                        print "<tr><td class=\"aws\">".XMLEncode($mot).
>                              " <a target=\"_blank\" href=\"http://www.baidu.com/s?wd=site:" .$SiteDomain. " ". $mot ."\">[Baidu]</a>" .
>                              " <a target=\"_blank\" href=\"http://www.google.cn/search?ie=gbk&q=site:" .$SiteDomain. " " . $mot ."\">[Google]</a>".
>                              " <a target=\"_blank\" href=\"http://www.yahoo.cn/search?p=site:" .$SiteDomain. " " . $mot ."\">[Yahoo!]</a>".
>                              "</td><td>$_keyphrases{$key}</td><td>$p %</td></tr>\n";


cd /var/log/proxy ; mv -f access_log access_log.1 ; kill -USR1 `cat /var/run/proxy.pid`

http://server/cgi-bin/awstats/awstats.pl?config=jc001.cn


ExtraSectionName1="Google crawls - Top 50"
ExtraSectionCodeFilter1="200 304"
ExtraSectionCondition1="UA,(.*Googlebot.*)"
ExtraSectionFirstColumnValues1="URL,(.*)"
ExtraSectionFirstColumnFormat1="<a href='%s' title='Item Crawled' target='_blank'>%s</a>"
ExtraSectionStatTypes1=PHBL
ExtraSectionAddAverageRow1=0
ExtraSectionAddSumRow1=1
MaxNbOfExtra1=50
MinHitExtra1=1

ExtraSectionName2="Baidu crawls - Top 50"
ExtraSectionCodeFilter2="200 304"
ExtraSectionCondition2="UA,(.*Baiduspider.*)"
ExtraSectionFirstColumnValues2="URL,(.*)"
ExtraSectionFirstColumnFormat2="<a href='%s' title='Item Crawled' target='_blank'>%s</a>"
ExtraSectionStatTypes2=PHBL
ExtraSectionAddAverageRow2=0
ExtraSectionAddSumRow2=2
MaxNbOfExtra2=50
MinHitExtra2=1

ExtraSectionName3="Yahoo Slurp crawls - Top 50"
ExtraSectionCodeFilter3="200 304"
ExtraSectionCondition3="UA,(.*Slurp.*)"
ExtraSectionFirstColumnValues3="URL,(.*)"
ExtraSectionFirstColumnFormat3="<a href='%s' title='Item Crawled' target='_blank'>%s</a>"
ExtraSectionStatTypes3=PHBL
ExtraSectionAddAverageRow3=0
ExtraSectionAddSumRow3=3
MaxNbOfExtra3=50
MinHitExtra3=1

ExtraSectionName4="MSN crawls - Top 50"
ExtraSectionCodeFilter4="200 304"
ExtraSectionCondition4="UA,(.*msnbot.*)"
ExtraSectionFirstColumnValues4="URL,(.*)"
ExtraSectionFirstColumnFormat4="<a href='%s' title='Item Crawled' target='_blank'>%s</a>"
ExtraSectionStatTypes4=PHBL
ExtraSectionAddAverageRow4=0
ExtraSectionAddSumRow4=4
MaxNbOfExtra4=50
MinHitExtra4=1

ExtraSectionName5="Sohu crawls - Top 50"
ExtraSectionCodeFilter5="200 304"
ExtraSectionCondition5="UA,(.*sogou.*)"
ExtraSectionFirstColumnValues5="URL,(.*)"
ExtraSectionFirstColumnFormat5="<a href='%s' title='Item Crawled' target='_blank'>%s</a>"
ExtraSectionStatTypes5=PHBL
ExtraSectionAddAverageRow5=0
ExtraSectionAddSumRow5=5
MaxNbOfExtra5=50
MinHitExtra5=1

ExtraTrackedRowsLimit=50000