http://sourceforge.net/projects/dk-milter/
wget http://nchc.dl.sourceforge.net/sourceforge/dk-milter/dk-milter-1.0.2.tar.gz

rpm for centos5:
http://www.topdog-software.com/oss/dk-milter/
wget http://www.topdog-software.com/oss/dk-milter/dk-milter-1.0.2-0.x86_64.rpm


DKIMProxy
http://jason.long.name/dkfilter/
Crypt::OpenSSL::RSA
Digest::SHA
Digest::SHA1
Error
Mail::Address
MIME::Base64
Net::DNS
Net::Server
Mail::DKIM

yum install perl-Error perl-MailTools perl-MIME-Base64

wget http://downloads.sourceforge.net/dkimproxy/dkimproxy-1.1.tar.gz
tar zxvf dkimproxy-1.1.tar.gz
cd dkimproxy-1.1
./configure --prefix=/usr/local/dkimproxy
make install

vi /etc/postfix/master.cf
#
# Before-filter SMTP server. Receive mail from the network and
# pass it to the content filter on localhost port 10035.
#
smtp      inet  n       -       n       -       -       smtpd
  -o smtpd_proxy_filter=127.0.0.1:10035
  -o smtpd_client_connection_count_limit=10
#
# After-filter SMTP server. Receive mail from the content filter on
# localhost port 10036.
#
127.0.0.1:10036 inet n  -       n       -        -      smtpd
  -o smtpd_authorized_xforward_hosts=127.0.0.0/8
  -o smtpd_client_restrictions=
  -o smtpd_helo_restrictions=
  -o smtpd_sender_restrictions=
  -o smtpd_recipient_restrictions=permit_mynetworks,reject
  -o smtpd_data_restrictions=
  -o mynetworks=127.0.0.0/8
  -o receive_override_options=no_unknown_recipient_checks

/usr/local/dkimproxy/bin/dkimproxy.in 127.0.0.1:10035 127.0.0.1:10036 &
/etc/init.d/postfix restart

wget http://www.topdog-software.com/files/dkim-genkey.sh
chmod +x dkim-genkey.sh
./dkim-genkey.sh -d jc001.cn

mv default.private /usr/local/dkimproxy/private.key

vi /etc/postfix/master.cf
#
# modify the default submission service to specify a content filter
# and restrict it to local clients and SASL authenticated clients only
#
submission  inet  n     -       n       -       -       smtpd
  -o smtpd_etrn_restrictions=reject
  -o smtpd_sasl_auth_enable=yes
  -o content_filter=dksign:127.0.0.1:10027
  -o receive_override_options=no_address_mappings
  -o smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject

#
# specify the location of the DomainKeys signing filter
#
dksign    unix  -       -       n       -       10      smtp
  -o smtp_send_xforward_command=yes

#
# service for accepting messages FROM the DomainKeys signing filter
#
127.0.0.1:10028 inet  n  -      n       -       10      smtpd
  -o content_filter=
  -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks
  -o smtpd_helo_restrictions=
  -o smtpd_client_restrictions=
  -o smtpd_sender_restrictions=
  -o smtpd_recipient_restrictions=permit_mynetworks,reject
  -o mynetworks=127.0.0.0/8
  -o smtpd_authorized_xforward_hosts=127.0.0.0/8

default._domainkey IN TXT "k=rsa; t=s; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCs63oYOrwcOIE/yMboCeoc3Z0CAANJjK/SbPFt1OINs8ZLkvhi1k1JKLck7eECQ9KOz7EK9+otl7dsDP6WzTgN0fKTjg7eVXbki3ueM655dLxSReI9MTpp5Nprox/7w8ToZO9qGeQywxvFv8/cIp98Mv1OvA4wVjIq+DJ7Q7RHrQIDAQAB"

/usr/local/dkimproxy/bin/dkimproxy.out --keyfile=/usr/local/dkimproxy/private.key --selector=default --domain=jc001.cn --method=relaxed 127.0.0.1:10027 127.0.0.1:10028 &
/etc/init.d/postfix restart

mail to check-auth@verifier.port25.com

vi /etc/maildroprc
# delete-dkim-fail
if (/^X-DKIM-Authentication-Results: fail/)
{
  to "/dev/null"
}


wget http://www.c-corp.net/linux/centos/4/i386/generic/SRPMS/dkim-milter-1.2.0-1.src.rpm
rpm -ivh dkim-milter-1.2.0-1.src.rpmcd /usr/src/redhat/SPECS
rpmbuild --bb dkim-milter.spec
cd /usr/src/redhat/RPMS/x86_64
rpm -ivh dkim-milter-1.2.0-1.x86_64.rpm --nodeps

mkdir /etc/dkim-milter
chown dkim-milt.dkim-milt /etc/dkim-milter
chmod 700 /etc/dkim-milter
chgrp postfix /var/run/dkim-milter
chmod 770 /var/run/dkim-milter

wget http://www.topdog-software.com/files/dkim-genkey.sh
chmod +x dkim-genkey.sh
./dkim-genkey.sh -d jc001.cn
mv default.private /etc/dkim-milter/jc001.cn_default.key.pem
chown dkim-milt.dkim-milt /etc/dkim-milter/jc001.cn_default.key.pem

default.txt 的内容加入 dns zone

vi /etc/sysconfig/dkim-milter
USER="dkim-milt"
PORT=local:/var/run/dkim-milter/dkim.sock
SIGNING_DOMAIN="jc001.cn"
SELECTOR_NAME="default"
KEYFILE="/etc/dkim-milter/${SIGNING_DOMAIN}_${SELECTOR_NAME}.key.pem"
SIGNER=yes
VERIFIER=yes
CANON=simple
SIGALG=rsa-sha1
REJECTION="bad=r,dns=t,int=t,no=a,miss=r"
EXTRA_ARGS="-h -l -D"
MILTER_GROUP="postfix"

wget http://www.topdog-software.com/files/dkim-milter -O /etc/init.d/dkim-milter
chkconfig --level 345 dkim-milter on
service dkim-milter start

vi /etc/postfix/main.cf
smtpd_milters = unix:/var/run/dkim-milter/dkim.sock
non_smtpd_milters = unix:/var/run/dkim-milter/dkim.sock

/etc/init.d/postfix restart

test:
Send a message to autorespond+dkim@dk.elandsys.com; the system will return a response to let you know if DKIM is working.


SpamAssassin DKIM
yum install perl-Mail-DKIM
Installing for dependencies: perl-Crypt-OpenSSL-RSA perl-Digest-SHA
yum install perl-Crypt-OpenSSL-Bignum
echo "loadplugin Mail::SpamAssassin::Plugin::DKIM" >> /etc/mail/spamassassin/init.pre
/etc/init.d/amavisd restart