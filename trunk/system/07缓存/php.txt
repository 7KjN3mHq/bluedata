## install freetds
tar zxvf freetds-0.63.tar.gz
cd freetds-0.63
./configure --prefix=/usr/local/freetds
make
make install
cd ..

## install gd_gif
tar zxvf gd-2.0.26gif.tar.gz
cd gd-2.0.26gif
./configure \
--prefix=/usr/local/gd \
--with-zlib \
--with-png \
--with-jpeg \
--with-freetype
make
make install
cd ..

## note
dom need: libxml2 libxml2-devel
mcrypt need: libmcrypt libmcrypt-devel
gd freetype need(for debian): libttf2 libttf-dev

## install php
tar jxvf php-4.4.4.tar.bz2
cd php-4.4.4
./configure \
--prefix=/usr/local/php \
--enable-mbstring=all \
--with-config-file-path=/usr/local/php/etc \
--with-apxs2=/usr/local/apache/bin/apxs \
--with-gd=/usr/local/gd \
--with-zlib \
--with-png \
--with-jpeg \
--with-freetype \
--with-mysql=/usr/local/mysql \
--with-mssql=/usr/local/freetds
make
make install
cp -f php.ini-dist /usr/local/php/etc/php.ini
cd ..

## install ZendOptimizer
tar zxvf ZendOptimizer-3.2.0-linux-glibc21-i386.tar.gz
cd ZendOptimizer-3.2.0-linux-glibc21-i386
./install
cd ..

## install eaccelerator
tar jxvf eaccelerator-0.9.5.tar.bz2
cd eaccelerator-0.9.5
/usr/local/php/bin/phpize
./configure --enable-eaccelerator=shared --with-php-config=/usr/local/php/bin/php-config
make
make install
cd ..

mkdir /tmp/eaccelerator
chmod 0777 /tmp/eaccelerator

## configuration
vi /usr/local/apache/conf/httpd.conf
AddType application/x-httpd-php .php .php3
DirectoryIndex index.html index.htm default.html default.htm index.php default.php index.php3 default.php3

vi /usr/local/php/etc/php.ini
default_charset = "gbk"
register_globals = On
max_execution_time = 5
post_max_size = 20M
upload_max_filesize = 20M
session.save_path = /dev/shm/php/session
session.gc_maxlifetime = 3600
session.bug_compat_42 = 0
session.bug_compat_warn = 0
mysql.allow_persistent = Off
mysql.default_socket = /var/run/mysqld/mysql.sock
mysql.connect_timeout = 10

[eAccelerator]
zend_extension="/usr/local/php/lib/php/extensions/no-debug-non-zts-20020429/eaccelerator.so"
eaccelerator.shm_size="32"
eaccelerator.cache_dir="/dev/shm/php/eaccelerator"
eaccelerator.enable="1"
eaccelerator.optimizer="1"
eaccelerator.check_mtime="1"
eaccelerator.debug="0"
eaccelerator.filter=""
eaccelerator.shm_max="0"
eaccelerator.shm_ttl="0"
eaccelerator.shm_prune_period="0"
eaccelerator.shm_only="0"
eaccelerator.compress="1"
eaccelerator.compress_level="9"

[Zend]
## Add
zend_optimizer.optimization_level=1023

vi /etc/rc.d/init.d/mkphpdir
#!/bin/sh

mkdir /dev/shm/php
chmod 777 /dev/shm/php
mkdir /dev/shm/php/session
chmod 777 /dev/shm/php/session
mkdir /dev/shm/php/eaccelerator
chmod 777 /dev/shm/php/eaccelerator

chmod +x /usr/local/sbin/mkphpdir
vi /etc/rc.local
/usr/local/sbin/mkphpdir


## Apache error log:
PHP Warning:  [eAccelerator] Can not create shared memory area in Unknown on line 0

-> eaccelerator.shm_size="32"